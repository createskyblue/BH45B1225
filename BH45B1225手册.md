# BH45B1225 寄存器描述
## 寄存器列表概览
| 地址 | 寄存器名称 | 上电复位值 |
|------|------------|------------|
| 00H  | PWRC       | 0000 0000  |
| 01H  | PGAC0      | -000 0000  |
| 02H  | PGAC1      | -000 000-  |
| 03H  | PGACS      | --00 0000  |
| 04H  | ADRL       | xxxx xxxx  |
| 05H  | ADRM       | xxxx xxxx  |
| 06H  | ADRH       | xxxx xxxx  |
| 07H  | ADCR0      | 0010 0000  |
| 08H  | ADCR1      | 0000 000-  |
| 09H  | ADCS       | ---0 0000  |
| 0AH  | ADCTE      | 1110 0100  |
| 0BH  | DAH        | 0000 0000  |
| 0CH  | DAL        | ---- 0000  |
| 0DH  | DACC       | 00------   |
| 0EH  | SIMC0      | 0----00--  |
| 10H  | SIMTOC     | 0000 0000  |
| 11H  | HIRCC      | -----001   |
| 12H  | HXTC       | -----000   |

### 表格注释
- `*`：热复位
- `-`：未定义
- `u`：不改变
- `x`：未知

---
## 各寄存器详细描述
### 1. PWRC 寄存器（地址 00H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | VCMEN | D6   | D5   | D4   | D3   | D2   | D1   | D0   |
| 读写 | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  |

- **VCMEN**：VCM 功能使能控制位
  - 0：除能，VCM 输出脚浮空，无功耗
  - 1：使能
- **D6~D0**：特性优化位
  - 010_1000B：对应 `ADCR1[FLMS2~0]=000B`，`fADCK=fMCLK/30`
  - 011_1100B：对应 `ADCR1[FLMS2~0]=010B`，`fADCK=fMCLK/12`
  - 其他值：保留位

### 2. PGAC0 寄存器（地址 01H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | -    | VGS1 | VGS0 | AGS1 | AGS0 | PGS2 | PGS1 | PGS0 |
| 读写 | -    | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  |

- **位7**：未定义，读为0
- **VGS1~VGS0**：REFP/REFN 差分参考电压增益选择位
  - 00：`VREFGN=1`
  - 01：`VREFGN=1/2`
  - 10：`VREFGN=1/4`
  - 11：保留位
- **AGS1~AGS0**：ADC PGAOP/PGAON 差分输入信号增益选择位
  - 00：`ADGN=1`
  - 01：`ADGN=2`（用于 `Gain=128=PGAGN×ADGN=64×2`）
  - 10/11：保留位
- **PGS2~PGS0**：PGA DI+/DI- 差分通道输入增益选择位
  - 000：`PGAGN=1`
  - 001：`PGAGN=2`
  - 010：`PGAGN=4`
  - 011：`PGAGN=8`
  - 100：`PGAGN=16`
  - 101：`PGAGN=32`
  - 110：`PGAGN=64`
  - 111：保留位

### 3. PGAC1 寄存器（地址 02H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | -    | INIS | INX1 | INX0 | DCSET2 | DCSET1 | DCSET0 | - |
| 读写 | -    | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | - |

- **位7/位0**：未定义，读为0
- **INIS**：输入端 IN1/IN2 内部连接控制位
  - 0：不连接
  - 1：连接
- **INX1~INX0**：输入端 IN1/IN2 与 PGA 差分输入端 DI+/DI- 连接控制位
  | INX[1:0] | IN1  | DI+  | IN2  | DI-  |
  |----------|------|------|------|------|
  | 00       | IN1  | DI+  | IN2  | DI-  |
  | 01       | IN1  | DI+  | IN2  | DI-  |
  | 10       | IN1  | DI+  | IN2  | DI-  |
  | 11       | IN1  | X    | IN2  | DI-  |
- **DCSET2~DCSET0**：差分输入信号 PGAOP/PGAON 偏置选择位
  - 000：`DCSET=+0V`
  - 001：`DCSET=+0.25×ΔVR_I`
  - 010：`DCSET=+0.5×ΔVR_I`
  - 011：`DCSET=+0.75×ΔVR_I`
  - 100：`DCSET=+0V`
  - 101：`DCSET=-0.25×ΔVR_I`
  - 110：`DCSET=-0.5×ΔVR_I`
  - 111：`DCSET=-0.75×ΔVR_I`

### 4. PGACS 寄存器（地址 03H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | -    | -    | CHSN2 | CHSN1 | CHSN0 | CHSP2 | CHSP1 | CHSP0 |
| 读写 | -    | -    | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  |

- **位7~6**：未定义，读为0
- **CHSN2~CHSN0**：PGA 反相输入端 IN2 选择位
  - 000：AN1
  - 001：AN3
  - 010/011：保留位
  - 100：VDACO
  - 101：AVSS
  - 110：VCM
  - 111：VTSN（温度传感器负极输出）
- **CHSP2~CHSP0**：PGA 正相输入端 IN1 选择位
  - 000：AN0
  - 001：AN2
  - 010/011：保留位
  - 100：VDACO
  - 101：保留位
  - 110：VCM
  - 111：VTSP（温度传感器正极输出）

### 5. ADRL/ADRM/ADRH 寄存器（地址 04H/05H/06H）
这三个寄存器用于存储 24 位 A/D 转换结果，以二进制补码形式表示，范围为 `-8388608~8388607`。
| 寄存器 | 位范围 | 功能描述 | 读写属性 |
|--------|--------|----------|----------|
| ADRL   | Bit7~Bit0 | 转换结果低 8 位 | R |
| ADRM   | Bit15~Bit8 | 转换结果中 8 位 | R |
| ADRH   | Bit23~Bit16 | 转换结果高 8 位 | R |

### 6. ADCR0 寄存器（地址 07H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | ADRST | ADSLP | ADOFF | ADOR3 | ADOR2 | ADOR1 | ADOR0 | VREFS |
| 读写 | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  |

- **ADRST**：A/D 转换器软件复位控制位
  - 0：除能，正常工作
  - 1：使能，复位内部 SINC 滤波器，当前转换数据失效
- **ADSLP**：休眠模式控制位
  - 0：正常模式
  - 1：休眠模式（仅保留 PGA 和 Bandgap 电路）
- **ADOFF**：A/D 模块电源控制位
  - 0：电源开
  - 1：电源关，降低功耗
- **ADOR3~ADOR0**：过采样率（OSR）选择位
  | 取值 | OSR 值 | 取值 | OSR 值 |
  |------|--------|------|--------|
  | 0000 | 32768 | 0100 | 2048 |
  | 0001 | 16384 | 0101 | 1024 |
  | 0010 | 8192 | 0110 | 512 |
  | 0011 | 4096 | 0111 | 256 |
  | 1000 | 128 | 其他 | 保留 |
- **VREFS**：参考电压选择位
  - 0：内部参考（VCM & AVSS）
  - 1：外部参考（VREFP & VREFN）

### 7. ADCR1 寄存器（地址 08H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | FLMS2 | FLMS1 | FLMS0 | VRBUFN | VRBUFP | ADCDL | EOC | - |
| 读写 | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | - |

- **FLMS2~FLMS0**：ADC 时钟分频比选择位
  - 000：`fADCK=fMCLK/30`
  - 010：`fADCK=fMCLK/12`
  - 其他：保留位
- **VRBUFN/VRBUFP**：参考电压输入缓存控制位
  - 0：除能缓存，使能旁路
  - 1：使能缓存，除能旁路
- **ADCDL**：数据锁存功能控制位
  - 0：数据更新
  - 1：数据锁存，不更新后续转换结果
- **EOC**：转换结束标志位
  - 0：转换中
  - 1：转换完成，需软件清除

### 8. ADCS 寄存器（地址 09H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | -    | -    | -    | ADCK4 | ADCK3 | ADCK2 | ADCK1 | ADCK0 |
| 读写 | -    | -    | -    | R/W  | R/W  | R/W  | R/W  | R/W  |

- **位7~5**：未定义，读为0
- **ADCK4~ADCK0**：ADC 时钟源 `fMCLK` 分频率选择位
  - 00000~11110：`fMCLK=fSYS/2/(ADCK[4:0]+1)`
  - 11111：`fMCLK=fSYS`

### 9. ADCTE 寄存器（地址 0AH）
- 位7~0 为保留位，需固定配置为 `1110_0111B`
- 读写属性：R/W

### 10. DAH/DAL 寄存器（地址 0BH/0CH）
用于设置 12 位 DAC 输出控制码，**需先写 DAL 再写 DAH**，数据才会生效。
| 寄存器 | 位范围 | 功能描述 | 读写属性 | 上电复位值 |
|--------|--------|----------|----------|------------|
| DAH    | Bit7~Bit0 | DAC 控制码高 8 位（Bit11~Bit4） | R/W | 0000 0000 |
| DAL    | Bit3~Bit0 | DAC 控制码低 4 位（Bit3~Bit0） | R/W | ---- 0000 |

### 11. DACC 寄存器（地址 0DH）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | DACEN | DACVRS | -    | -    | -    | -    | -    | -    |
| 读写 | R/W  | R/W  | -    | -    | -    | -    | -    | -    |

- **DACEN**：DAC 使能控制位
  - 0：除能
  - 1：使能
- **DACVRS**：DAC 参考电压选择位
  - 0：参考电压来自 AVDD
  - 1：参考电压来自 VCM

### 12. SIMC0 寄存器（地址 0EH）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | SIMS | -    | -    | -    | SIMDEB1 | SIMDEB0 | -    | -    |
| 读写 | R/W  | -    | -    | -    | R/W  | R/W  | -    | -    |

- **SIMS**：工作模式控制位
  - 0：正常工作
  - 1：不可预测反应，需保持 0
- **SIMDEB1~SIMDEB0**：I2C 去抖时间选择位
  - 00：无去抖
  - 01：2 个系统时钟
  - 10/11：4 个系统时钟

### 13. SIMTOC 寄存器（地址 10H）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | SIMTOEN | SIMTOF | SIMTOS5 | SIMTOS4 | SIMTOS3 | SIMTOS2 | SIMTOS1 | SIMTOS0 |
| 读写 | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  | R/W  |

- **SIMTOEN**：I2C 超时功能使能位
  - 0：除能
  - 1：使能
- **SIMTOF**：I2C 超时标志位
  - 0：未超时
  - 1：超时，需软件清除
- **SIMTOS5~SIMTOS0**：超时时间选择位
  - 超时时钟源：`fSUB/32`，其中 `fSUB=fSYS/128`
  - 超时时间计算公式：`([SIMTOS5:SIMTOS0]+1)×(32/fSUB)`

### 14. HIRCC 寄存器（地址 11H）
用于控制内部高速 RC 振荡器（HIRC）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | -    | -    | -    | -    | -    | HIRCO | HIRCF | HIRCEN |
| 读写 | -    | -    | -    | -    | -    | R/W  | R | R/W  |

- **HIRCO**：HIRC 时钟输出控制位，需保留为 0
- **HIRCF**：HIRC 稳定标志位
  - 0：未稳定
  - 1：稳定（使能后需 16 个系统时钟稳定）
- **HIRCEN**：HIRC 使能控制位
  - 0：除能
  - 1：使能

### 15. HXTC 寄存器（地址 12H）
用于控制外部晶体振荡器（HXT）
| 位   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
|------|------|------|------|------|------|------|------|------|
| 名称 | -    | -    | -    | -    | -    | HXTM | HXTF | HXTEN |
| 读写 | -    | -    | -    | -    | -    | R/W  | R | R/W  |

- **HXTM**：HXT 模式选择位
  - 0：`HXT ≤10MHz`，灌/源电流小
  - 1：`HXT >10MHz`，灌/源电流大
- **HXTF**：HXT 稳定标志位
  - 0：未稳定
  - 1：稳定
- **HXTEN**：HXT 使能控制位
  - 0：除能
  - 1：使能


# BH45B1225 芯片使用注意事项
## 一、 电气特性注意事项
1.  **电源电压范围**
    - 工作电压范围为 **2.4V~5.5V**，超出此范围会导致芯片功能异常或损坏。
    - 数字电源（VDD）与模拟电源（AVDD）建议使用相同电压，且需做好电源滤波。
2.  **极限参数限制**
    - 储存温度范围：**-60℃~150℃**，工作温度范围：**-40℃~85℃**，超出会影响芯片可靠性。
    - 总功耗最大为 **500mW**，需避免长时间满负载运行导致过热。
3.  **电流消耗控制**
    - 工作电流与时钟源相关，HIRC 时钟模式下电流低于 HXT 模式，电池供电场景优先选择 HIRC。
    - 待机电流最低可至 1μA（3V 条件下），闲置时需关闭未使用外设并进入待机模式以降低功耗。

## 二、 振荡器配置注意事项
1.  **振荡器选择**
    - 通过 **XTSB 引脚**选择振荡器类型：低电平为外部晶振（HXT），高电平为内部振荡器（HIRC）。
    - 外部晶振模式下，需确保 OSC1/OSC2 引脚连接匹配的晶振及负载电容；内部振荡器模式下，HIRC 稳定需要 **16 个系统时钟周期**。
2.  **时钟稳定检查**
    - 配置 HIRC 后，需通过 **HIRCC 寄存器的 HIRCF 位**确认振荡器稳定；配置 HXT 后，通过 **HXTC 寄存器的 HXTF 位**确认稳定。
    - HXT 模式选择需注意频率：`HXTM=0` 对应 ≤10MHz 晶振，`HXTM=1` 对应 >10MHz 晶振，且需在 HXT 使能前配置。

## 三、 A/D 转换器使用注意事项
1.  **工作模式控制**
    - A/D 转换器有四种工作模式，由 **ADCR0 寄存器的 ADOFF、ADSLP、ADRST 位**联合控制：
      - 掉电模式（ADOFF=1）：关闭所有 A/D 相关电路，功耗最低。
      - 休眠模式（ADOFF=0、ADSLP=1）：仅保留 PGA 和 Bandgap 电路，缩短启动时间。
      - 正常模式（ADOFF=0、ADSLP=0、ADRST=0）：正常转换数据。
      - 复位模式（ADOFF=0、ADSLP=0、ADRST=1）：复位 SINC 滤波器，当前数据失效。
2.  **数据传输率配置**
    - 数据传输率计算公式：`数据传输率 = f_MCLK / (N × OSR)`，其中 `N` 由 FLMS 位选择（30 或 12），`OSR` 由 ADOR 位选择（128~32768）。
    - 当数据传输率设置为 **10Hz** 时，芯片对 50Hz/60Hz 工频干扰有陷波抑制效果，适合高精度测量场景。
3.  **参考电压选择**
    - 可选择内部参考（VCM=1.25V）或外部参考（VREFP/VREFN），通过 **ADCR0 寄存器的 VREFS 位**配置。
    - 外部参考电压需满足 `V_REFN +1V ≤ V_REFP ≤ AVDD`，且可通过 PGAC0 寄存器的 VGS 位对参考电压进行 1/2 或 1/4 衰减。
4.  **输入通道与增益配置**
    - 输入通道通过 **PGACS 寄存器的 CHSP/CHSN 位**选择，支持单端输入和差分输入；单端输入时，需将非信号端接 VCM 电压。
    - 总增益由 PGA 增益（PGS 位）、ADC 增益（AGS 位）和参考电压增益（VGS 位）共同决定，最大总增益可达 128 倍。
5.  **数据读取与处理**
    - 转换结果存储在 **ADRL/ADRM/ADRH 寄存器**中，为 24 位二进制补码，范围为 `-8388608~8388607`。
    - 读取数据前，建议设置 **ADCR1 寄存器的 ADCDL 位**锁存数据，防止读取过程中数据更新；读取完成后需清零 ADCDL 位。
    - 转换完成标志由 **ADCR1 寄存器的 EOC 位**指示，硬件置 1 后需软件清零。

## 四、 DAC 配置注意事项
1.  **寄存器写入顺序**
    - DAC 控制码需写入 **DAL 和 DAH 寄存器**，且必须**先写 DAL 寄存器，再写 DAH 寄存器**，数据才会从影子缓存器生效。
2.  **参考电压与使能控制**
    - 通过 **DACC 寄存器的 DACVRS 位**选择 DAC 参考电压：0 为 AVDD，1 为 VCM。
    - 通过 **DACC 寄存器的 DACEN 位**使能 DAC，使能后会产生额外电流（最大 450μA @ V_REF=5V）。

## 五、 I2C 接口通信注意事项
1.  **地址配置**
    - 芯片作为 I2C 从机时，地址由 **A1/A2 引脚**和 XTSB 引脚共同决定：
      - XTSB=0 时，地址固定为 **0xA0**。
      - XTSB=1 时，地址由 A2/A1 引脚组合决定（0xA0、0xB0、0xC0、0xD0）；8-pin 封装地址固定为 **0xD0**。
2.  **通信时序与去抖**
    - I2C 支持标准模式（100kHz）和快速模式（400kHz），需根据系统时钟频率配置去抖时间（通过 **SIMC0 寄存器的 SIMDEB 位**）。
    - 起始条件为 SCL 高电平时 SDA 由高变低，停止条件为 SCL 高电平时 SDA 由低变高；数据传输时，SCL 高电平期间 SDA 状态不可改变。
3.  **超时功能控制**
    - 通过 **SIMTOC 寄存器**配置 I2C 超时功能：SIMTOEN=1 使能超时，SIMTOS 位设置超时时间。
    - 超时发生时，SIMTOF 位会置 1，需软件清零；超时时钟源为 `f_SUB/32`（`f_SUB = f_SYS/128`）。

## 六、 温度传感器使用注意事项
1.  **温度数据获取**
    - 内部温度传感器输出通过 **VTSP/VTSN 引脚**接入 PGA，需将 PGACS 寄存器的 CHSP/CHSN 位配置为 VTSP/VTSN。
    - 温度传感器温度系数为 **175μV/℃**，可通过转换结果计算当前温度，用于补偿温度漂移。
2.  **校准建议**
    - 在已知温度点对传感器输出进行校准，存储校准系数，实际测量时根据系数修正结果，提升精度。

## 七、 硬件设计注意事项
1.  **PCB 布局布线**
    - 模拟地（AVSS）与数字地（VSS）需单点接地，减少串扰；模拟信号路径需短且远离数字信号路径。
    - AVDD、VDD 引脚需就近并联 **0.1μF 去耦电容**，VCM 引脚建议并联 **1μF 滤波电容**。
2.  **引脚处理**
    - 未使用的模拟输入引脚（ANx）建议接 AVSS 或 VCM，避免悬空引入噪声。
    - I2C 引脚（SCL/SDA）需外接上拉电阻，阻值根据通信速率选择（通常 4.7kΩ~10kΩ）。

## 八、 编程与调试注意事项
1.  **寄存器配置顺序**
    - 配置 A/D 转换器时，需遵循固定步骤：使能 VCM → 配置增益 → 选择输入通道 → 设置时钟 → 配置传输率 → 关闭掉电/休眠模式 → 复位并启动转换。
    - 修改振荡器配置后，需等待稳定标志置位再进行后续操作，避免时钟不稳定导致功能异常。
2.  **功耗优化建议**
    - 非转换期间，设置 `ADOFF=1` 关闭 A/D 模块；长期闲置时，进入待机模式并关闭 VCM（`VCMEN=0`）。
    - 根据实际需求选择最低的数据传输率和增益，降低芯片工作电流。
3.  **数据有效性验证**
    - 读取转换数据后，可通过多次采样取平均值的方式降低噪声影响；同时结合温度传感器数据，补偿温度对转换结果的影响。